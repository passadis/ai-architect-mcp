# yaml-language-server: $schema=https://raw.githubusercontent.com/Azure/azure-dev/main/schemas/v1.0/azure.yaml.json

name: ai-architect-mcp
metadata:
  template: ai-architect-mcp@1.0.0
  description: AI-powered Azure Architecture Generator that automatically creates AI agents for design documents and diagram generation

infra:
  provider: terraform

services:
  frontend:
    project: ./frontend/architect-ai
    host: containerapp
    language: js
    docker:
      path: Dockerfile
  backend:
    project: ./backend
    host: containerapp
    language: python
    docker:
      path: Dockerfile
  mcp-service:
    project: ./mcp-service
    host: containerapp
    language: python
    docker:
      path: Dockerfile

hooks:
  preprovision:
    posix:
      run: |
        # Ensure environment is configured
        echo "Preparing Azure AI Architect deployment..."
        echo "‚ö†Ô∏è  Important: You need an existing Azure AI Foundry PROJECT (not individual agents)."
        echo "üìö Create your project at: https://ai.azure.com/"
        echo ""
        echo "ü§ñ Agents will be created AUTOMATICALLY by the application - no manual setup required!"
        echo ""
        
        # Validate required environment variables
        if [ -z "$PROJECT_ENDPOINT" ]; then
          echo "‚ö†Ô∏è  Warning: PROJECT_ENDPOINT not set. Update .env after deployment."
        fi
        
        echo "‚úÖ Pre-provision checks complete"
    windows:
      run: |
        # Ensure environment is configured
        Write-Host "Preparing Azure AI Architect deployment..." -ForegroundColor Cyan
        Write-Host "‚ö†Ô∏è  Important: You need an existing Azure AI Foundry PROJECT (not individual agents)." -ForegroundColor Yellow
        Write-Host "üìö Create your project at: https://ai.azure.com/" -ForegroundColor White
        Write-Host ""
        Write-Host "ü§ñ Agents will be created AUTOMATICALLY by the application - no manual setup required!" -ForegroundColor Green
        Write-Host ""
        
        # Validate required environment variables
        if (-not $env:PROJECT_ENDPOINT) {
          Write-Host "‚ö†Ô∏è  Warning: PROJECT_ENDPOINT not set. Update .env after deployment." -ForegroundColor Yellow
        }
        
        Write-Host "‚úÖ Pre-provision checks complete" -ForegroundColor Green
      shell: pwsh

  postprovision:
    posix:
      run: |
        echo "üéâ Azure AI Architect deployed successfully!"
        echo ""
        echo "üìã Next steps:"
        echo "1. Update .env with your Azure AI Foundry project details:"
        echo "   - PROJECT_ENDPOINT: Your Azure AI Foundry project endpoint"
        echo "   - AGENT_NAME: (Optional) Custom agent name (default: architectai-design-agent)"
        echo "   - MODEL_NAME: (Optional) Model to use (default: gpt-4o)"
        echo ""
        echo "ü§ñ The application will automatically create these agents for you:"
        echo "   ‚úÖ Architecture Design Agent - Generates detailed Azure architecture documents"
        echo "   ‚úÖ Diagram Generation Agent - Creates visual architecture diagrams"
        echo "   ‚úÖ Validation Agent - Validates and improves diagram quality"
        echo ""
        echo "3. Access your application at the frontend URL shown above"
        echo ""
        echo "üìö Documentation: https://github.com/your-org/azure-ai-architect"
    windows:
      run: |
        Write-Host "üéâ Azure AI Architect deployed successfully!" -ForegroundColor Green
        Write-Host ""
        Write-Host "üìã Next steps:" -ForegroundColor Cyan
        Write-Host "1. Update .env with your Azure AI Foundry project details:" -ForegroundColor White
        Write-Host "   - PROJECT_ENDPOINT: Your Azure AI Foundry project endpoint" -ForegroundColor Gray
        Write-Host "   - AGENT_NAME: (Optional) Custom agent name (default: architectai-design-agent)" -ForegroundColor Gray
        Write-Host "   - MODEL_NAME: (Optional) Model to use (default: gpt-4o)" -ForegroundColor Gray
        Write-Host ""
        Write-Host "ü§ñ The application will automatically create these agents for you:" -ForegroundColor Green
        Write-Host "   ‚úÖ Architecture Design Agent - Generates detailed Azure architecture documents" -ForegroundColor Gray
        Write-Host "   ‚úÖ Diagram Generation Agent - Creates visual architecture diagrams" -ForegroundColor Gray
        Write-Host "   ‚úÖ Validation Agent - Validates and improves diagram quality" -ForegroundColor Gray
        Write-Host ""
        Write-Host "3. Access your application at the frontend URL shown above" -ForegroundColor White
        Write-Host ""
        Write-Host "üìö Documentation: https://github.com/your-org/azure-ai-architect" -ForegroundColor Cyan
      shell: pwsh
