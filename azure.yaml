# yaml-language-server: $schema=https://raw.githubusercontent.com/Azure/azure-dev/main/schemas/v1.0/azure.yaml.json

name: ai-architect-mcp
metadata:
  template: ai-architect-mcp@1.0.0
  description: AI-powered Azure Architecture Generator that automatically creates AI agents for design documents and diagram generation

infra:
  provider: terraform

services:
  frontend:
    project: ./frontend/architect-ai
    host: containerapp
    language: js
    docker:
      path: Dockerfile
  backend:
    project: ./backend
    host: containerapp
    language: python
    docker:
      path: Dockerfile
  mcp-service:
    project: ./mcp-service
    host: containerapp
    language: python
    docker:
      path: Dockerfile

hooks:
  preprovision:
    posix:
      shell: sh
      run: |
        # Ensure environment is configured
        echo "Preparing Azure AI Architect deployment..."
        echo ""
        echo "‚ö†Ô∏è  IMPORTANT: Azure AI Foundry Region Requirements"
        echo "This template requires a region that supports Azure AI Foundry."
        echo ""
        echo "‚úÖ Supported regions:"
        echo "  - East US (eastus)"
        echo "  - East US 2 (eastus2)" 
        echo "  - West US 2 (westus2)"
        echo "  - West US 3 (westus3)"
        echo "  - North Central US (northcentralus)"
        echo "  - South Central US (southcentralus)"
        echo "  - West Europe (westeurope)"
        echo "  - North Europe (northeurope)"
        echo "  - UK South (uksouth)"
        echo "  - Australia East (australiaeast)"
        echo "  - Japan East (japaneast)"
        echo "  - Canada Central (canadacentral)"
        echo "  - France Central (francecentral)"
        echo "  - Switzerland North (switzerlandnorth)"
        echo ""
        echo "ü§ñ This template will automatically:"
        echo "  ‚úÖ Create Azure AI Foundry service"
        echo "  ‚úÖ Deploy GPT-4o model"
        echo "  ‚úÖ Create AI Project for agent management"
        echo "  ‚úÖ Configure managed identity authentication"
        echo ""
        echo "Pre-provision checks complete"
    windows:
      shell: pwsh
      run: |
        # Ensure environment is configured
        Write-Host "Preparing Azure AI Architect deployment..." -ForegroundColor Green
        Write-Host ""
        Write-Host "‚ö†Ô∏è  IMPORTANT: Azure AI Foundry Region Requirements" -ForegroundColor Yellow
        Write-Host "This template requires a region that supports Azure AI Foundry." -ForegroundColor Yellow
        Write-Host ""
        Write-Host "‚úÖ Supported regions:" -ForegroundColor Green
        Write-Host "  - East US (eastus)"
        Write-Host "  - East US 2 (eastus2)"
        Write-Host "  - West US 2 (westus2)"
        Write-Host "  - West US 3 (westus3)"
        Write-Host "  - North Central US (northcentralus)"
        Write-Host "  - South Central US (southcentralus)"
        Write-Host "  - West Europe (westeurope)"
        Write-Host "  - North Europe (northeurope)"
        Write-Host "  - UK South (uksouth)"
        Write-Host "  - Australia East (australiaeast)"
        Write-Host "  - Japan East (japaneast)"
        Write-Host "  - Canada Central (canadacentral)"
        Write-Host "  - France Central (francecentral)"
        Write-Host "  - Switzerland North (switzerlandnorth)"
        Write-Host ""
        Write-Host "ü§ñ This template will automatically:" -ForegroundColor Cyan
        Write-Host "  ‚úÖ Create Azure AI Foundry service"
        Write-Host "  ‚úÖ Deploy GPT-4o model"
        Write-Host "  ‚úÖ Create AI Project for agent management"
        Write-Host "  ‚úÖ Configure managed identity authentication"
        Write-Host ""
        Write-Host "Pre-provision checks complete" -ForegroundColor Green

  postprovision:
    posix:
      shell: sh
      run: |
        echo "üéâ Azure AI Architect deployed successfully!"
        echo ""
        echo "‚úÖ What was automatically created:"
        echo "  ‚Ä¢ Azure AI Foundry service with GPT-4o model"
        echo "  ‚Ä¢ AI Project configured for agent management"
        echo "  ‚Ä¢ All resources secured with managed identity"
        echo ""
        echo "üöÄ Your application is ready!"
        echo "The AI agents will be created automatically when you first use the application."
        echo ""
        echo "üìñ Next steps:"
        echo "1. Access your application at the frontend URL shown above"
        echo "2. Start generating Azure architecture designs!"
        echo ""
        echo "Need help? Check the documentation for advanced configuration options."
    windows:
      shell: pwsh
      run: |
        Write-Host "üéâ Azure AI Architect deployed successfully!" -ForegroundColor Green
        Write-Host ""
        Write-Host "‚úÖ What was automatically created:" -ForegroundColor Green
        Write-Host "  ‚Ä¢ Azure AI Foundry service with GPT-4o model" -ForegroundColor Gray
        Write-Host "  ‚Ä¢ AI Project configured for agent management" -ForegroundColor Gray
        Write-Host "  ‚Ä¢ All resources secured with managed identity" -ForegroundColor Gray
        Write-Host ""
        Write-Host "üöÄ Your application is ready!" -ForegroundColor Cyan
        Write-Host "The AI agents will be created automatically when you first use the application." -ForegroundColor White
        Write-Host ""
        Write-Host "üìñ Next steps:" -ForegroundColor Cyan
        Write-Host "1. Access your application at the frontend URL shown above" -ForegroundColor White
        Write-Host "2. Start generating Azure architecture designs!" -ForegroundColor White
        Write-Host ""
        Write-Host "Need help? Check the documentation for advanced configuration options." -ForegroundColor Gray
      
